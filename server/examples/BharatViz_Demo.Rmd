---
title: "BharatViz R Demo"
subtitle: "Generate Publication-Ready India Choropleth Maps"
author: "BharatViz"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    theme: flatly
    highlight: tango
    code_folding: show
  pdf_document:
    toc: true
---

[![Open in Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/saketkc/bharatviz/blob/main/server/examples/BharatViz_Demo.Rmd)

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.width = 10,
  fig.height = 8
)
```

# Introduction

**BharatViz** provides an easy-to-use R interface for generating beautiful choropleth maps of India at both state and district levels.

**Features:**

- âœ… State-level and district-level maps
- âœ… 15+ color scales (sequential and diverging)
- âœ… Multiple export formats (PNG, SVG, PDF)
- âœ… Works with data frames and named lists
- âœ… Publication-ready outputs

---

# Setup

## Install Required Packages

```{r install-packages, eval=FALSE}
# Install required packages
install.packages(c("httr", "jsonlite", "base64enc", "R6", "png", "grid"))
```

## Load BharatViz Client

```{r load-client}
# Load required libraries
library(httr)
library(jsonlite)
library(base64enc)
library(R6)

# Download and source the BharatViz R client
if (!file.exists("bharatviz.R")) {
  download.file(
    "https://raw.githubusercontent.com/saketkc/bharatviz/main/server/examples/bharatviz.R",
    "bharatviz.R"
  )
}

source("bharatviz.R")

# Initialize client
bv <- BharatViz$new(api_url = "http://bharatviz.saketlab.in/api")
```

---

# Part 1: State-Level Maps

## Example 1: Quick Map from Named List

The simplest way to create a map:

```{r quick-map}
# Create data as a named list
literacy_data <- list(
  "Kerala" = 93.9,
  "Delhi" = 86.3,
  "Maharashtra" = 82.9,
  "Tamil Nadu" = 80.3,
  "Gujarat" = 79.3,
  "Karnataka" = 75.6,
  "Uttar Pradesh" = 69.7,
  "Bihar" = 63.8
)

# Generate and display map
result <- quick_map(
  data = literacy_data,
  title = "Literacy Rate by State",
  legend_title = "Percentage (%)",
  color_scale = "greens"
)
```

## Example 2: From Data Frame

Working with a data frame:

```{r dataframe-map}
# Create a data frame
state_data <- data.frame(
  state = c(
    "Maharashtra", "Kerala", "Karnataka", "Tamil Nadu",
    "Gujarat", "Rajasthan", "Uttar Pradesh", "West Bengal",
    "Andhra Pradesh", "Telangana"
  ),
  gdp_growth = c(7.8, 6.5, 8.3, 8.7, 8.1, 7.3, 6.8, 7.6, 7.8, 8.2)
)

print(head(state_data))

# Generate map
result <- bv$generate_map(
  data = state_data,
  title = "State GDP Growth Rate (2023)",
  legend_title = "% Growth",
  color_scale = "blues"
)

# Display
bv$show_map(result)
```

## Example 3: Save to PDF

Export publication-ready maps:

```{r save-pdf}
# Save all formats at once
saved_files <- bv$save_all(result, basename = "state_gdp_growth")

# Or save specific format
bv$save_map(result, filename = "my_map.png", format = "png")
```

## Example 4: Custom Column Names

Handle data frames with custom column names:

```{r custom-columns}
# Data frame with custom columns
custom_df <- data.frame(
  state_name = c("Punjab", "Haryana", "Himachal Pradesh",
                 "Uttarakhand", "Jharkhand"),
  unemployment = c(5.2, 4.8, 3.9, 4.5, 6.1)
)

# The client auto-detects columns!
result <- bv$generate_map(
  data = custom_df,
  title = "Unemployment Rate by State",
  legend_title = "Percentage",
  color_scale = "reds"
)

bv$show_map(result)
```

## Example 5: Different Color Scales

Try various color palettes:

```{r color-scales}
# Sequential color scales
scales <- c("blues", "greens", "viridis", "plasma")

for (scale in scales) {
  result <- bv$generate_map(
    data = state_data,
    title = paste("GDP Growth -", scale),
    color_scale = scale
  )

  cat("\n### Color scale:", scale, "\n")
  bv$show_map(result)
}
```

---

# Part 2: District-Level Maps

## Example 6: Quick District Map

```{r district-quick}
# Sample district data
district_data <- data.frame(
  state = c(
    "Maharashtra", "Maharashtra", "Maharashtra", "Maharashtra",
    "Karnataka", "Karnataka", "Kerala", "Kerala", "Kerala",
    "Tamil Nadu", "Tamil Nadu", "Delhi", "Delhi"
  ),
  district = c(
    "Mumbai", "Mumbai Suburban", "Pune", "Nagpur",
    "Bengaluru Urban", "Mysuru",
    "Thiruvananthapuram", "Kottayam", "Ernakulam",
    "Chennai", "Coimbatore",
    "Central", "South"
  ),
  value = c(
    89.7, 90.9, 86.2, 89.5,
    88.7, 73.4,
    93.0, 97.2, 95.7,
    90.2, 84.2,
    86.3, 87.4
  )
)

print(head(district_data))

# Generate district map
result <- quick_districts_map(
  data = district_data,
  map_type = "LGD",
  title = "District Literacy Rates",
  legend_title = "Literacy %",
  color_scale = "spectral"
)
```

## Example 7: Different Map Types

Compare different district boundary definitions:

```{r district-types}
# LGD boundaries (latest)
result_lgd <- bv$generate_districts_map(
  data = district_data,
  map_type = "LGD",
  title = "LGD District Boundaries"
)
bv$show_map(result_lgd)

# NFHS5 boundaries
result_nfhs5 <- bv$generate_districts_map(
  data = district_data,
  map_type = "NFHS5",
  title = "NFHS-5 District Boundaries"
)
bv$show_map(result_nfhs5)
```

## Example 8: Load from CSV

```{r load-csv}
# Create sample CSV
write.csv(district_data, "districts_sample.csv", row.names = FALSE)

# Load and visualize
df <- read.csv("districts_sample.csv")

result <- bv$generate_districts_map(
  data = df,
  map_type = "LGD",
  title = "Districts from CSV",
  legend_title = "Values",
  color_scale = "viridis",
  show_state_boundaries = TRUE
)

bv$show_map(result)
```

---

# Part 3: Advanced Features

## Example 9: Get Metadata

Access map statistics:

```{r metadata}
# Generate map with all formats
result <- bv$generate_map(
  data = state_data,
  title = "GDP Growth with Metadata",
  formats = c("png", "svg", "pdf")
)

# Print metadata
cat("Map Statistics:\n")
cat("  Min value:", result$metadata$minValue, "\n")
cat("  Max value:", result$metadata$maxValue, "\n")
cat("  Mean value:", result$metadata$meanValue, "\n")
cat("  Color scale:", result$metadata$colorScale, "\n")
cat("  Data points:", result$metadata$dataPoints, "\n")
```

## Example 10: Inverted Color Scales

For metrics where lower is better:

```{r inverted-scale}
# Unemployment data (lower is better)
unemployment <- data.frame(
  state = c("Kerala", "Maharashtra", "Karnataka", "Bihar", "Uttar Pradesh"),
  value = c(4.2, 4.8, 3.9, 7.5, 6.1)
)

result <- bv$generate_map(
  data = unemployment,
  title = "Unemployment Rate (Inverted Scale)",
  legend_title = "Percentage",
  color_scale = "reds",
  invert_colors = TRUE  # Red for high unemployment
)

bv$show_map(result)
```

## Example 11: Hide Labels

Create cleaner maps for presentations:

```{r hide-labels}
result <- bv$generate_map(
  data = state_data,
  title = "Clean Map (No Labels)",
  color_scale = "blues",
  hide_state_names = TRUE,
  hide_values = TRUE
)

bv$show_map(result)
```

---

# Available Color Scales

## Sequential Scales

```{r show-sequential, echo=FALSE}
cat(paste(COLOR_SCALES$sequential, collapse = ", "))
```

- **Best for**: Progressive data (population, GDP, literacy)
- **Examples**: `blues`, `greens`, `viridis`, `plasma`

## Diverging Scales

```{r show-diverging, echo=FALSE}
cat(paste(COLOR_SCALES$diverging, collapse = ", "))
```

- **Best for**: Data with meaningful center point
- **Examples**: `spectral`, `rdylbu`, `brbg`

---

# District Map Types

| Type | Description | Use Case |
|------|-------------|----------|
| **LGD** | Latest Government of India boundaries | General purpose, most recent |
| **NFHS5** | NFHS-5 (2019-21) survey boundaries | Compare with NFHS-5 data |
| **NFHS4** | NFHS-4 (2015-16) survey boundaries | Compare with NFHS-4 data |

---

# Quick Reference

## Minimal Code Patterns

### States

```r
# From named list
quick_map(list("Kerala" = 93.9), title = "My Map")

# From data frame
bv$generate_map(df)

# Save PDF
bv$save_all(result, basename = "my_map")
```

### Districts

```r
# Quick district map
quick_districts_map(data, map_type = 'LGD', title = "Districts")

# From data frame
bv$generate_districts_map(df, map_type = 'LGD')

# Save all formats
bv$save_all(result, basename = "districts")
```

---

# Real-World Example

Complete workflow from data to publication:

```{r real-world}
# 1. Load your data
my_data <- data.frame(
  state = c("Andhra Pradesh", "Bihar", "Gujarat", "Karnataka",
            "Kerala", "Maharashtra", "Rajasthan", "Tamil Nadu"),
  indicator = c(67.7, 63.8, 79.3, 75.6, 93.9, 82.9, 67.1, 80.3)
)

# 2. Generate map
result <- bv$generate_map(
  data = my_data,
  title = "State-Level Indicator",
  legend_title = "Percentage",
  color_scale = "viridis",
  formats = c("png", "svg", "pdf")
)

# 3. Save all formats
bv$save_all(result, basename = "publication_map")

# 4. Display
bv$show_map(result)

cat("\nâœ“ Your publication-ready maps are saved!\n")
cat("  - publication_map.png (High-res image)\n")
cat("  - publication_map.svg (Vector graphics)\n")
cat("  - publication_map.pdf (Publication ready)\n")
```

---

# Troubleshooting

## Common Issues

### API Connection Error

If you get connection errors, check:

```r
# Test API health
httr::GET("http://bharatviz.saketlab.in/api/health")
```

### State Names Not Matching

Ensure state names match exactly:

- âœ… `Maharashtra`
- âœ… `Tamil Nadu`
- âŒ `Maharastra` (typo)
- âŒ `TN` (abbreviation)

### Package Installation

```r
install.packages(c("httr", "jsonlite", "base64enc", "R6", "png"))
```

---

# Summary

**From data to PDF in 3 lines:**

```r
source("bharatviz.R")
bv <- BharatViz$new()
bv$save_all(your_data, basename = "publication_map")
```

ðŸ“„ **Your PDF is ready for journals, reports, and presentations!**

---

# Additional Resources

- **GitHub Repository**: https://github.com/saketkc/bharatviz
- **Web Application**: http://bharatviz.saketlab.in
- **API Documentation**: http://bharatviz.saketlab.in/api
- **Python Examples**: See `BharatViz_Complete_Demo.ipynb`

---

# Session Info

```{r session-info}
sessionInfo()
```
