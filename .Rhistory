head(df)
nsso.state.district <- df %>%
select(state, district) %>%
arrange(state, district) %>%
unique()
nsso.state.district
setdiff(nsso.state.district$state, nfhs5.districts$state_name)
setdiff(nfhs5.districts$state_name,nsso.state.district$state)
df$state[df$state == "Delhi" ] <- "Nct Of Delhi"
df <- read_csv("~/github/2025_NSSO_regions/nsso_76_regions.csv")
df$state[df$state %in% c("Dadra & Nagar Haveli", "Daman & Diu")] <-"Dadra & Nagar Haveli & Daman & Diu"
df$state[df$state == "Delhi"] <- "Nct Of Delhi"
nsso.state.district <- df %>%
select(state, district) %>%
arrange(state, district) %>%
unique()
setdiff(nfhs5.districts$state_name,nsso.state.district$state)
setdiff(nsso.state.district$state, nfhs5.districts$state_name)
colnames(nsso.state.district) <- c("state_name", "district_name")
nsso.state.district$NSSO <- TRUE
nfhs5.districts$NFHS5 <- TRUE
setdiff(nfhs4.districts$state_name,nsso.state.district$state_name)
setdiff(nsso.state.district$state_name, nfhs4.districts$state_name)
nfhs4.districts <- read_csv(here("public/India_NFHS4_state_district_list.csv"))
nfhs5.districts$NFHS5 <- TRUE
nfhs4.districts$state_name[nfhs4.districts$state_name== "Andaman and Nicobar Islands"] <- "Andaman & Nicobar Islands"
nfhs4.districts$state_name[nfhs4.districts$state_name== "Dadra and Nagar Haveli"] <- "Dadra & Nagar Haveli & Daman & Diu"
nfhs4.districts$state_name[nfhs4.districts$state_name== "Daman and Diu"] <- "Dadra & Nagar Haveli & Daman & Diu"
nfhs4.districts$state_name[nfhs4.districts$state_name== "Delhi"] <- "Nct Of Delhi"
nfhs4.districts$state_name[nfhs4.districts$state_name== "Himanchal Pradesh"] <- "Himachal Pradesh"
nfhs4.districts$NFHS4 <- TRUE
nfhs5.districts <- read_csv(here("public/India_NFHS5_state_district_list.csv"))
nfhs5.districts$NFHS5 <- TRUE
setdiff(nfhs4.districts$state_name,nsso.state.district$state_name)
setdiff(nsso.state.district$state_name, nfhs4.districts$state_name)
df.nfhs4.nfhs5 <- df %>% left_join(nfhs4.districts) %>% left_join(nfhs5.districts)
df <- read_csv("~/github/2025_NSSO_regions/nsso_76_regions.csv")
setdiff(nsso.state.district$state_name, nfhs4.districts$state_name)
df$state[df$state %in% c("Dadra & Nagar Haveli", "Daman & Diu")] <-"Dadra & Nagar Haveli & Daman & Diu"
df$state[df$state == "Delhi"] <- "Nct Of Delhi"
nsso.state.district <- df %>%
select(state, district) %>%
arrange(state, district) %>%
unique()
colnames(nsso.state.district) <- c("state_name", "district_name")
nsso.state.district$NSSO <- TRUE
nfhs4.districts <- read_csv(here("public/India_NFHS4_state_district_list.csv"))
nfhs4.districts$state_name[nfhs4.districts$state_name== "Andaman and Nicobar Islands"] <- "Andaman & Nicobar Islands"
nfhs4.districts$state_name[nfhs4.districts$state_name== "Dadra and Nagar Haveli"] <- "Dadra & Nagar Haveli & Daman & Diu"
nfhs4.districts$state_name[nfhs4.districts$state_name== "Daman and Diu"] <- "Dadra & Nagar Haveli & Daman & Diu"
nfhs4.districts$state_name[nfhs4.districts$state_name== "Delhi"] <- "Nct Of Delhi"
nfhs4.districts$state_name[nfhs4.districts$state_name== "Himanchal Pradesh"] <- "Himachal Pradesh"
nfhs4.districts$NFHS4 <- TRUE
nfhs5.districts <- read_csv(here("public/India_NFHS5_state_district_list.csv"))
nfhs5.districts$NFHS5 <- TRUE
setdiff(nfhs5.districts$state_name,nsso.state.district$state_name)
setdiff(nsso.state.district$state_name, nfhs5.districts$state_name)
setdiff(nfhs4.districts$state_name,nsso.state.district$state_name)
setdiff(nsso.state.district$state_name, nfhs4.districts$state_name)
df.nfhs4.nfhs5 <- df %>% left_join(nfhs4.districts) %>% left_join(nfhs5.districts)
df.nfhs4.nfhs5 <- df %>% left_join(nfhs4.districts)# %>% left_join(nfhs5.districts)
df.nfhs4.nfhs5 <- nsso.state.district %>% left_join(nfhs4.districts)# %>% left_join(nfhs5.districts)
df.nfhs4.nfhs5 <- nsso.state.district %>% left_join(nfhs4.districts) %>% left_join(nfhs5.districts)
table(df.nfhs4.nfhs5$NFHS4)
table(df.nfhs4.nfhs5$NFHS5)
table(df.nfhs4.nfhs5$NFHS4)
table(df.nfhs4.nfhs5$NSSO)
df.nfhs4 <- nsso.state.district %>% left_join(nfhs4.districts)
df.nfhs4.missing <- df.nfhs4 %>% filter(is.na(NFHS4))
df.nfhs4.missing
table(df.nfhs4.missing$state_name)
df.nfhs4.nfhs5 %>% filter(district_name=="Balodabazar")
nfhs5.districts %>% filter(grepl("balod", district_name,ignore.case = T))
nsso.state.district$district_name <- str_to_title(gsub(pattern = " ", replacement = "", x = nsso.state.district$district_name))
nfhs4.districts$district_name <- str_to_title(gsub(pattern = " ", replacement = "", x = nfhs4.districts$district_name))
nfhs5.districts$district_name <- str_to_title(gsub(pattern = " ", replacement = "", x = nfhs5.districts$district_name))
df.nfhs4.nfhs5 <- nsso.state.district %>% left_join(nfhs4.districts) %>% left_join(nfhs5.districts)
table(df.nfhs4.nfhs5$NSSO)
table(df.nfhs4.nfhs5$NFHS4)
table(df.nfhs4.nfhs5$NFHS5)
df.nfhs4 <- nsso.state.district %>% left_join(nfhs4.districts)
df.nfhs4.missing <- df.nfhs4 %>% filter(is.na(NFHS4))
table(df.nfhs4.missing$state_name)
df.nfhs4.missing
nfhs5.districts %>% filter(grepl("balod", district_name,ignore.case = T))
nfhs4.districts %>% filter(grepl("balod", district_name,ignore.case = T))
table(df$state, df$nss_region)
table(df$state, df$nss_region) %>% View()
table(df$state, df$nss_region) %>% filter(Freq>0) %>% View()
table(df$state, df$nss_region) %>% as.data.frame() %>% filter(Freq>0) %>% View()
lgd <- read_csv("public/India_LGD_state_district_list.csv")
lgd <- read_csv("public/bharatviz-lgd-district-template.csv")
lgd$`some column name` <- NULL
lgd$LGD <- TRUE
df.nfhs4.nfhs5 <- nsso.state.district %>% left_join(nfhs4.districts) %>% left_join(nfhs5.districts) %>% left_join(lgd %>% select(state_name, district_name, LGD))
nfhs5.districts
nfhs5.districts$reg_code <- NULL
nfhs4.districts$reg_code <- NULL
nfhs5.districts
nfhs5.districts$reg_code <- NULL
df.nfhs4.nfhs5 <- nsso.state.district %>% left_join(nfhs4.districts) %>% left_join(nfhs5.districts) %>% left_join(lgd %>% select(state_name, district_name, LGD))
table(df.nfhs4.nfhs5$NSSO)
table(df.nfhs4.nfhs5$NFHS4)
table(df.nfhs4.nfhs5$NFHS5)
table(df.nfhs4.nfhs5$LGD)
setdiff(lgd$state_name,lgd$state_name)
setdiff(lgd$state_name,nsso.state.district$state_name)
setdiff(nsso.state.district$state_name, lgd$state_name)
df.nfhs5 <- nsso.state.district %>% left_join(nfhs5.districts)
df.nfhs5.missing <- df.nfhs5 %>% filter(is.na(NFHS4))
df.nfhs5 <- nsso.state.district %>% left_join(nfhs5.districts)
df.nfhs5.missing <- df.nfhs5 %>% filter(is.na(NFHS5))
df.nfhs5.missing
table(df.nfhs5.missing$district_name)
table(df.nfhs5.missing$state_name)
table(nfhs5.districts$state_name)
table(df.nfhs5.missing$state_name)
library(tidyverse)
df <- read_csv("~/github/2025_NSSO_regions/nsso_76_regions.csv")
lgd <- read_csv("public/bharatviz-lgd-district-template.csv")
lgd$`some column name` <- NULL
lgd$LGD <- TRUE
df$state[df$state %in% c("Dadra & Nagar Haveli", "Daman & Diu")] <-"Dadra & Nagar Haveli & Daman & Diu"
df$state[df$state == "Delhi"] <- "Nct Of Delhi"
nsso.state.district <- df %>%
select(state, district) %>%
arrange(state, district) %>%
unique()
colnames(nsso.state.district) <- c("state_name", "district_name")
nsso.state.district$NSSO <- TRUE
nfhs4.districts <- read_csv(here("public/India_NFHS4_state_district_list.csv"))
nfhs4.districts$state_name[nfhs4.districts$state_name== "Andaman and Nicobar Islands"] <- "Andaman & Nicobar Islands"
nfhs4.districts$state_name[nfhs4.districts$state_name== "Dadra and Nagar Haveli"] <- "Dadra & Nagar Haveli & Daman & Diu"
nfhs4.districts$state_name[nfhs4.districts$state_name== "Daman and Diu"] <- "Dadra & Nagar Haveli & Daman & Diu"
nfhs4.districts$state_name[nfhs4.districts$state_name== "Delhi"] <- "Nct Of Delhi"
nfhs4.districts$state_name[nfhs4.districts$state_name== "Himanchal Pradesh"] <- "Himachal Pradesh"
nfhs4.districts$NFHS4 <- TRUE
nfhs5.districts <- read_csv(here("public/India_NFHS5_state_district_list.csv"))
nfhs5.districts$NFHS5 <- TRUE
setdiff(nfhs5.districts$state_name,nsso.state.district$state_name)
setdiff(nsso.state.district$state_name, nfhs5.districts$state_name)
setdiff(nfhs4.districts$state_name,nsso.state.district$state_name)
setdiff(nsso.state.district$state_name, nfhs4.districts$state_name)
setdiff(lgd$state_name,nsso.state.district$state_name)
setdiff(nsso.state.district$state_name, lgd$state_name)
nsso.state.district$nsso_district_name <- nsso.state.district$district_name
nsso.state.district$district_name <- str_to_title(gsub(pattern = " ", replacement = "", x = nsso.state.district$district_name))
nfhs4.districts$NFHS4_district_name <- nfhs4.districts$district_name
nfhs4.districts$district_name <- str_to_title(gsub(pattern = " ", replacement = "", x = nfhs4.districts$district_name))
nfhs5.districts$NFHS5_district_name <- nfhs5.districts$district_name
nfhs5.districts$district_name <- str_to_title(gsub(pattern = " ", replacement = "", x = nfhs5.districts$district_name))
nfhs4.districts$reg_code <- NULL
nfhs5.districts$reg_code <- NULL
df.nfhs4.nfhs5 <- nsso.state.district %>% left_join(nfhs4.districts) %>% left_join(nfhs5.districts) %>% left_join(lgd)
df.nfhs5 <- nsso.state.district %>% left_join(nfhs5.districts)
df.nfhs5.missing <- df.nfhs5 %>% filter(is.na(NFHS5))
df.nfhs5.missing
nfhs5.districts.join <- left_join(nsso.state.district, nfhs5.districts)
nfhs5.missing <- nfhs5.districts.join %>% filter(is.na(NFHS5))
nfhs5.missing
nfhs5.districts.join <- left_join(nfhs5.districts, nsso.state.district)
nfhs5.missing <- nfhs5.districts.join %>% filter(is.na(NFHS5))
nfhs5.missing
nfhs5.districts.join
table(nfhs5.districts.join$NFHS5)
dim(nfhs5.districts)
table(nfhs5.districts.join$nsso_district_name)
nsso.state.district <- df %>%
select(state, district, nss_region, nss_region_code) %>%
arrange(state, district) %>%
unique()
nsso.state.district <- df %>%
select(state, district, nss_region, nss_region_code) %>%
arrange(state, district) %>%
unique()
colnames(nsso.state.district) <- c("state_name", "district_name", "nss_region", "nss_region_code")
nsso.state.district$NSSO <- TRUE
nfhs4.districts <- read_csv(here("public/India_NFHS4_state_district_list.csv"))
nfhs4.districts$state_name[nfhs4.districts$state_name== "Andaman and Nicobar Islands"] <- "Andaman & Nicobar Islands"
nfhs4.districts$state_name[nfhs4.districts$state_name== "Dadra and Nagar Haveli"] <- "Dadra & Nagar Haveli & Daman & Diu"
nfhs4.districts$state_name[nfhs4.districts$state_name== "Daman and Diu"] <- "Dadra & Nagar Haveli & Daman & Diu"
nfhs4.districts$state_name[nfhs4.districts$state_name== "Delhi"] <- "Nct Of Delhi"
nfhs4.districts$state_name[nfhs4.districts$state_name== "Himanchal Pradesh"] <- "Himachal Pradesh"
nfhs4.districts$NFHS4 <- TRUE
nfhs5.districts <- read_csv(here("public/India_NFHS5_state_district_list.csv"))
nfhs5.districts$NFHS5 <- TRUE
setdiff(nfhs5.districts$state_name,nsso.state.district$state_name)
setdiff(nsso.state.district$state_name, nfhs5.districts$state_name)
setdiff(nfhs4.districts$state_name,nsso.state.district$state_name)
setdiff(nsso.state.district$state_name, nfhs4.districts$state_name)
setdiff(lgd$state_name,nsso.state.district$state_name)
setdiff(nsso.state.district$state_name, lgd$state_name)
nsso.state.district$nsso_district_name <- nsso.state.district$district_name
nsso.state.district$district_name <- str_to_title(gsub(pattern = " ", replacement = "", x = nsso.state.district$district_name))
nfhs4.districts$NFHS4_district_name <- nfhs4.districts$district_name
nfhs4.districts$district_name <- str_to_title(gsub(pattern = " ", replacement = "", x = nfhs4.districts$district_name))
nfhs5.districts$NFHS5_district_name <- nfhs5.districts$district_name
nfhs5.districts$district_name <- str_to_title(gsub(pattern = " ", replacement = "", x = nfhs5.districts$district_name))
nfhs4.districts$reg_code <- NULL
nfhs5.districts$reg_code <- NULL
df.nfhs4.nfhs5 <- nsso.state.district %>% left_join(nfhs4.districts) %>% left_join(nfhs5.districts) %>% left_join(lgd)
table(df.nfhs4.nfhs5$NSSO)
table(df.nfhs4.nfhs5$NFHS4)
table(df.nfhs4.nfhs5$NFHS5)
table(df.nfhs4.nfhs5$LGD)
df.nfhs4 <- nsso.state.district %>% left_join(nfhs4.districts)
df.nfhs4.missing <- df.nfhs4 %>% filter(is.na(NFHS4))
table(df.nfhs4.missing$state_name)
df.nfhs5 <- nsso.state.district %>% left_join(nfhs5.districts)
df.nfhs5.missing <- df.nfhs5 %>% filter(is.na(NFHS5))
df.nfhs5.missing
statewise <- table(df$state, df$nss_region) %>% as.data.frame() %>% filter(Freq>0) %>% View()
nfhs5.missing <- nfhs5.districts.join %>% filter(is.na(NFHS5))
nfhs5.missing
df.nsso.nfhs5 <- nsso.state.district %>% left_join(nfhs5.districts)
nfhs5.districts.join
nsso.state.district$nss_region
nfhs5.districts.join
nfhs5.districts.join <- left_join(nfhs5.districts, nsso.state.district)
nfhs5.missing <- nfhs5.districts.join %>% filter(is.na(NFHS5))
nfhs5.missing
nfhs5.districts.join
table(nfhs5.districts.join$nss_region)
table(nfhs5.districts.join$nss_region) %>% sort()
table(nfhs5.districts.join$state_name, nfhs5.districts.join$nss_region)
table(nfhs5.districts.join$state_name, nfhs5.districts.join$nss_region) %>% View()
statewise <- table(df$state, df$nss_region) %>% as.data.frame() %>% filter(Freq>0) %>% View() %>% as.data.frame() %>% filter(Freq>0) %>% View() %>% arrange(Var1, Var2)
statewise <- table(df$state, df$nss_region) %>% as.data.frame() %>% filter(Freq>0) %>% View() %>% as.data.frame() %>% filter(Freq>0)  %>% arrange(Var1, Var2)
statewise <- table(df$state, df$nss_region) %>% as.data.frame() %>% filter(Freq>0) %>% View() %>% as.data.frame() %>% filter(Freq>0)  %>% arrange(Var1)
statewise <- table(df$state, df$nss_region) %>% as.data.frame() %>% filter(Freq>0)  %>% arrange(Var1)
View(statewise)
write_vsv(nfhs5.districts.join, "~/github/2025_NSSO_regions/India_NFHS5_NSSO_regions_joined.csv")
write_csv(nfhs5.districts.join, "~/github/2025_NSSO_regions/India_NFHS5_NSSO_regions_joined.csv")
nfhs5.districts.join$nsso_state_region <- paste(nfhs5.districts.join$state_name, nfhs5.districts.join$nss_region, sep = " - ")
write_csv(nfhs5.districts.join, "~/github/2025_NSSO_regions/India_NFHS5_NSSO_regions_joined.csv")
nfhs5.districts.join$district_name <- nfhs5.districts.join$NFHS5_district_name
write_csv(nfhs5.districts.join, "~/github/2025_NSSO_regions/India_NFHS5_NSSO_regions_joined.csv")
length(unique(nfhs5.districts.join$nsso_state_region))
nfhs5.missing <- nfhs5.districts.join %>% filter(is.na(NSSO))
nfhs5.missing
nsso.state.district$state_nsso_region <- paste(nsso.state.district$state_name, nsso.state.district$nss_region, sep = " - ")
write_csv(nsso.state.district, "~/github/2025_NSSO_regions/India_NSSO_state_region_list.csv")
length(unique(nsso.state.district$state_nsso_region))
nfhs4 <- read_csv("https://github.com/HindustanTimesLabs/nfhs-data/raw/refs/heads/master/nfhs_district-wise.csv")
nfhs4
df <- read_csv("public/NFHS5_districts_all_indicators.csv")
df.select <- df %>% select(`State/UT`, `District Names`, `Men age 15 years and above wih high or very high (>140 mg/dl) Blood sugar level  or taking medicine to control blood sugar level23 (%)`)
grepl("People", x = colnames(df))
grepl("People", x = colnames(df), ignore.case = T)
grep("People", x = colnames(df), ignore.case = T, value=T)
nfhs4
grep(pattern = "Blood sugar", x = nfhs4$indicator_name, value = T)
grep(pattern = "Blood sugar", x = nfhs4$indicator_name, value = T) %>% unique()
grep(pattern = "Blood sugar", x = nfhs4$indicator_name, value = T, ignore.case = T) %>% unique()
grep(pattern = "blood sugar", x = nfhs4$indicator_name, value = T, ignore.case = T) %>% unique()
grep(pattern = "or very high", x = nfhs4$indicator_name, value = T, ignore.case = T) %>% unique()
grep(pattern = "very high", x = nfhs4$indicator_name, value = T, ignore.case = T) %>% unique()
nfhs4.select <- nfhs4 %>% select(state, district, indicator_name, total) %>% filter(indicator %in% c("Blood sugar level - high (>140 mg/dl) (%)"))
nfhs4.select <- nfhs4 %>% select(state, district, indicator_name, total, indicator_name) %>% filter(indicator_name %in% c("Blood sugar level - high (>140 mg/dl) (%)"))
nfhs4.select$indicator_name <- NULL
nfhs4 <- read_csv("https://github.com/HindustanTimesLabs/nfhs-data/raw/refs/heads/master/nfhs_district-wise.csv")
nfhs4.select <- nfhs4 %>% select(state, district, indicator_name, total) %>% filter(indicator_name %in% c("Blood sugar level - high (>140 mg/dl) (%)"))
nfhs4.select$indicator_name <- NULL
colnames(nfhs4.select) <- c("state_name", "district_name",  "% of people with high blood sugar level")
source("/data/github/bharatviz/scripts/03_Create_NFHS5_district_demo.R", echo = TRUE)
nfhs4.select <- nfhs4.select %>% arrange(state_name, district_name)
write_csv(nfhs4.select, "public/nfhs4_blood_sugar_levels.csv")
min(nfhs4.select$`% of people with high blood sugar level`)
hist(nfhs4.select$`% of people with high blood sugar level`)
hist(as.numeric(nfhs4.select$`% of people with high blood sugar level`))
nfhs4.select %>% filter(`%`% of people with high blood sugar level`<0)
nfhs4.select %>% filter(`% of people with high blood sugar level`<0)
grep(pattern = "very high", x = nfhs4$indicator_name, value = T, ignore.case = T) %>% unique()
nfhs4.select <- nfhs4 %>% select(state, district, indicator_name, total) %>% filter(indicator_name %in%  c("Very high (Systolic >=180 mm of Hg and/or Diastolic >=110 mm of Hg) (%)")
#                                                                                    c("Blood sugar level - high (>140 mg/dl) (%)")
)
nfhs4.select$indicator_name <- NULL
colnames(nfhs4.select) <- c("state_name", "district_name",  "% of people with high blood sugar level")
nfhs4.select <- nfhs4.select %>% arrange(state_name, district_name)
hist(as.numeric(nfhs4.select$`% of people with high blood sugar level`))
nfhs4.select %>% filter(`% of people with high blood sugar level`<0)
colnames(nfhs4.select) <- c("state_name", "district_name",  "% of people with high blood pressure")
nfhs4.select <- nfhs4.select %>% arrange(state_name, district_name)
nfhs4.select$`% of people with high blood pressure` <- as.numeric(nfhs4.select$`% of people with high blood pressure`)
nfhs4.select$`% of people with high blood pressure`[nfhs4.select$`% of people with high blood pressure` <0] <- NA
write_csv(nfhs4.select, "public/nfhs4_blood_pressure.csv")
grep(pattern = "very high", x = nfhs4$indicator_name, value = T, ignore.case = T) %>% unique()
grep(pattern = "egg", x = nfhs4$indicator_name, value = T, ignore.case = T) %>% unique()
grep(pattern = "high", x = nfhs4$indicator_name, value = T, ignore.case = T) %>% unique()
nfhs4.select <- nfhs4 %>% select(state, district, indicator_name, total) %>% filter(indicator_name %in%  c("Moderately high (Systolic 160-179 mm of Hg and/or Diastolic 100-109 mm of Hg) (%)")
#                                                                                    c("Blood sugar level - high (>140 mg/dl) (%)")
)
nfhs4.select$indicator_name <- NULL
colnames(nfhs4.select) <- c("state_name", "district_name",  "% of people with high blood pressure")
nfhs4.select <- nfhs4.select %>% arrange(state_name, district_name)
nfhs4.select$`% of people with high blood pressure` <- as.numeric(nfhs4.select$`% of people with high blood pressure`)
nfhs4.select$`% of people with high blood pressure`[nfhs4.select$`% of people with high blood pressure` <0] <- NA
write_csv(nfhs4.select, "public/nfhs4_blood_pressure.csv")
nfhs4.select <- nfhs4 %>% select(state, district, indicator_name, total) %>% filter(indicator_name %in%  c("Blood sugar level - high (>140 mg/dl) (%)")
#                                                                                    c("Blood sugar level - high (>140 mg/dl) (%)")
)
nfhs4.select$indicator_name <- NULL
colnames(nfhs4.select) <- c("state_name", "district_name",  "% of people with high blood sugar")
nfhs4.select <- nfhs4.select %>% arrange(state_name, district_name)
nfhs4.select$`% of people with high blood sugar` <- as.numeric(nfhs4.select$`% of people with high blood sugar`)
nfhs4.select$`% of people with high blood sugar`[nfhs4.select$`% of people with high blood pressure` <0] <- NA
nfhs4.select$`% of people with high blood sugar`[nfhs4.select$`% of people with high blood sugar` <0] <- NA
write_csv(nfhs4.select, "public/nfhs4_blood_pressure.csv")
write_csv(nfhs4.select, "public/nfhs4_blood_sugar.csv")
nfhs4.select[nfhs4.select$`% of people with high blood sugar`>20,]
nfhs4.select$`% of people with high blood sugar`[nfhs4.select$district_name=="Kolkata"] <- NA
write_csv(nfhs4.select, "public/nfhs4_blood_sugar.csv")
nfhs4 <- read_csv("https://github.com/HindustanTimesLabs/nfhs-data/raw/refs/heads/master/nfhs_district-wise.csv")
nfhs4.select <- nfhs4 %>% select(state, district, indicator_name, total) %>% filter(indicator_name %in%  c("Blood sugar level - high (>140 mg/dl) (%)")
#                                                                                    c("Blood sugar level - high (>140 mg/dl) (%)")
)
nfhs4.select$indicator_name <- NULL
colnames(nfhs4.select) <- c("state_name", "district_name",  "% of people with high blood sugar")
nfhs4.select <- nfhs4.select %>% arrange(state_name, district_name)
nfhs4.select$`% of people with high blood sugar` <- as.numeric(nfhs4.select$`% of people with high blood sugar`)
nfhs4.select$`% of people with high blood sugar`[nfhs4.select$`% of people with high blood sugar` <0] <- NA
nfhs4.select$`% of people with high blood sugar`[nfhs4.select$district_name=="Kolkata"] <- NA
write_csv(nfhs4.select, "public/nfhs4_blood_sugar.csv")
write_csv(nfhs4.select, "public/nfhs4_blood_sugar_levels.csv")
library(tidyverse)
library(here)
library(sf)
library(rmapshaper)
read_gzipped_geojson <- function(gz_file_path) {
# Create a connection to the gzipped file
con <- gzcon(file(gz_file_path, "rb"))
# Read the content and close the connection
geojson_content <- readLines(con, warn = FALSE)
close(con)
# Collapse the lines into a single string
geojson_str <- paste(geojson_content, collapse = "")
# Write to a temporary file
temp_file <- tempfile(fileext = ".geojson")
writeLines(geojson_str, temp_file)
# Read with sf
sf_object <- read_sf(temp_file)
# Clean up
file.remove(temp_file)
return(sf_object)
}
data <- read_gzipped_geojson("~/github/misc_projects/37_india_pincode_boundary/All_India_pincode_Boundary-19312.geojson.gz")
pincode.map <- read_gzipped_geojson("~/github/misc_projects/37_india_pincode_boundary/All_India_pincode_Boundary-19312.geojson.gz")
head(pincode.map)
length(unique(pincode$Divison))
length(unique(pincode.map$Divison))
length(unique(pincode.map$Division))
length(unique(pincode.map$Circle))
pincode.map$Division <- trimws(pincode.map$Division)
pincode.map$Circle <- trimws(pincode.map$Circle)
pincode.map$Office_Name <- trimws(pincode.map$Office_Name)
pincode_dist <- pincode.map %>%
select(Pincode, Circle, Division,Office_Name) %>%
as.data.frame() %>%
select(Pincode, Circle, Division,Office_Name) %>%
arrange(Pincode, Circle, Division,Office_Name) %>%
unique()
write.csv(pincode_dist,
here("public/India_Pincode_list.csv"),
row.names = FALSE
)
dim(pincode_dist)
pincode_dist
pincode.map$Office_Name <- trimws(pincode.map$Office_Name)
pincode.map$Office_Name <- gsub(pattern = "S.O.", replacement = "SO", x = pincode.map$Office_Name)
pincode.map$Office_Name <- gsub(pattern = "S.O", replacement = "SO", x = pincode.map$Office_Name)
pincode.map$Office_Name <- gsub(pattern = "SO.", replacement = "SO", x = pincode.map$Office_Name)
pincode_dist <- pincode.map %>%
select(Pincode, Circle, Division,Office_Name) %>%
as.data.frame() %>%
select(Pincode, Circle, Division,Office_Name) %>%
arrange(Pincode, Circle, Division,Office_Name) %>%
unique()
pincode_dist
pincode.map <- read_gzipped_geojson("~/github/misc_projects/37_india_pincode_boundary/All_India_pincode_Boundary-19312.geojson.gz")
pincode.map$Division <- trimws(pincode.map$Division)
pincode.map$Circle <- trimws(pincode.map$Circle)
pincode.map$Office_Name <- trimws(pincode.map$Office_Name)
pincode.map$Office_Name <- gsub(pattern = "S\.O\.", replacement = "SO", x = pincode.map$Office_Name)
pincode.map$Office_Name <- gsub(pattern = "S\.O", replacement = "SO", x = pincode.map$Office_Name)
pincode.map$Office_Name <- gsub(pattern = "SO\.", replacement = "SO", x = pincode.map$Office_Name)
pincode.map$Office_Name <- gsub(pattern = "S\\.O\\.", replacement = "SO", x = pincode.map$Office_Name)
pincode_dist
pincode.map$Office_Name <- gsub(pattern = "S\\.O\\.", replacement = "SO", x = pincode.map$Office_Name)
pincode.map$Office_Name <- gsub(pattern = "S\\.O", replacement = "SO", x = pincode.map$Office_Name)
pincode.map$Office_Name <- gsub(pattern = "SO\\.", replacement = "SO", x = pincode.map$Office_Name)
pincode.map$Office_Name <- gsub(pattern = "H\\.O\\.", replacement = "HO", x = pincode.map$Office_Name)
pincode.map$Office_Name <- gsub(pattern = "SO\\.", replacement = "SO", x = pincode.map$Office_Name)
pincode.map$Office_Name <- gsub(pattern = "H\\.O", replacement = "HO", x = pincode.map$Office_Name)
pincode.map$Office_Name <- gsub(pattern = "HO\.", replacement = "HO", x = pincode.map$Office_Name)
pincode_dist <- pincode.map %>%
select(Pincode, Circle, Division,Office_Name) %>%
as.data.frame() %>%
select(Pincode, Circle, Division,Office_Name) %>%
arrange(Pincode, Circle, Division,Office_Name) %>%
unique()
pincode.map$Office_Name <- gsub(pattern = "HO\\.", replacement = "HO", x = pincode.map$Office_Name)
pincode_dist <- pincode.map %>%
select(Pincode, Circle, Division,Office_Name) %>%
as.data.frame() %>%
select(Pincode, Circle, Division,Office_Name) %>%
arrange(Pincode, Circle, Division,Office_Name) %>%
unique()
pincode_dist
write.csv(pincode_dist,
here("public/India_Pincode_list.csv"),
row.names = FALSE
)
unique(st_geometry_type(pincode.map))
pincode.map <- st_transform(pincode.map, "EPSG:4326")
mv_simpl <- st_simplify(pincode.map, preserveTopology = FALSE, dTolerance = 1000)
pincode.map <- st_make_valid(pincode.map)
mv_simpl <- st_simplify(pincode.map, preserveTopology = FALSE, dTolerance = 1000)
pincode.map <- pincode.map %>%
mutate(
geometry = map(geometry, function(geom) {
if (st_geometry_type(geom) == "MULTIPOLYGON") {
# Convert MULTIPOLYGON to GEOMETRYCOLLECTION
polygons <- st_cast(geom, "POLYGON")
geom_list <- as.list(polygons)
return(st_geometrycollection(geom_list))
} else {
return(geom)
}
})
) %>%
st_drop_geometry() %>%
bind_cols(
geometry = st_sfc(unlist(.$geometry, recursive = FALSE), crs = st_crs(pincode.map))
) %>%
st_as_sf()
pincode.map <- st_transform(pincode.map, "EPSG:4326")
pincode.map <- st_make_valid(pincode.map)
mv_simpl <- st_simplify(pincode.map, preserveTopology = FALSE, dTolerance = 1000)
# Step 1: Transform to Indian planar CRS (UTM Zone 43N for central India)
# This allows using traditional (non-spherical) simplification algorithms
pincode.map <- st_transform(pincode.map, "EPSG:32643")  # UTM Zone 43N
# Step 2: Fix any invalid geometries
pincode.map <- st_make_valid(pincode.map)
# Step 3: Simplify using planar coordinates (dTolerance in meters)
# Using rmapshaper which is more robust for complex geometries
# keep = 0.05 means keep 5% of points (aggressive simplification)
# You can adjust this value: higher = less simplification (0.01 = 1%, 0.1 = 10%)
mv_simpl <- ms_simplify(pincode.map, keep = 0.05, keep_shapes = TRUE)
# Step 4: Transform back to WGS84 for web mapping
mv_simpl <- st_transform(mv_simpl, "EPSG:4326")
# Step 5: Final validation to ensure clean geometries
mv_simpl <- st_make_valid(mv_simpl)
# Step 6: Write to file
st_write(mv_simpl,
here("public/India_Pincodes_simplified.geojson"),
driver = "GeoJSON",
delete_dsn = TRUE
)
ggplot(mv_simpl) + geom_sf()
# Step 3: Simplify using planar coordinates (dTolerance in meters)
# Using rmapshaper which is more robust for complex geometries
# keep = 0.05 means keep 5% of points (aggressive simplification)
# You can adjust this value: higher = less simplification (0.01 = 1%, 0.1 = 10%)
mv_simpl <- ms_simplify(pincode.map, keep = 0.01, keep_shapes = TRUE)
# Step 4: Transform back to WGS84 for web mapping
mv_simpl <- st_transform(mv_simpl, "EPSG:4326")
# Step 5: Final validation to ensure clean geometries
mv_simpl <- st_make_valid(mv_simpl)
# Step 6: Write to file
st_write(mv_simpl,
here("public/India_Pincodes_simplified.geojson"),
driver = "GeoJSON",
delete_dsn = TRUE
)
ggplot(mv_simpl) + geom_sf()
# Step 3: Simplify using planar coordinates (dTolerance in meters)
# Using rmapshaper which is more robust for complex geometries
# keep = 0.05 means keep 5% of points (aggressive simplification)
# You can adjust this value: higher = less simplification (0.01 = 1%, 0.1 = 10%)
mv_simpl <- ms_simplify(pincode.map, keep = 0.005, keep_shapes = TRUE)
ggplot(mv_simpl) + geom_sf()
# Step 4: Transform back to WGS84 for web mapping
mv_simpl <- st_transform(mv_simpl, "EPSG:4326")
# Step 5: Final validation to ensure clean geometries
mv_simpl <- st_make_valid(mv_simpl)
# Step 6: Write to file
st_write(mv_simpl,
here("public/India_Pincodes_simplified.geojson"),
driver = "GeoJSON",
delete_dsn = TRUE
)
# Step 3: Simplify using planar coordinates (dTolerance in meters)
# Using rmapshaper which is more robust for complex geometries
# keep = 0.05 means keep 5% of points (aggressive simplification)
# You can adjust this value: higher = less simplification (0.01 = 1%, 0.1 = 10%)
mv_simpl <- ms_simplify(pincode.map, keep = 0.001, keep_shapes = TRUE)
# Step 4: Transform back to WGS84 for web mapping
mv_simpl <- st_transform(mv_simpl, "EPSG:4326")
# Step 5: Final validation to ensure clean geometries
mv_simpl <- st_make_valid(mv_simpl)
# Step 6: Write to file
st_write(mv_simpl,
here("public/India_Pincodes_simplified.geojson"),
driver = "GeoJSON",
delete_dsn = TRUE
)
# Step 3: Simplify using planar coordinates (dTolerance in meters)
# Using rmapshaper which is more robust for complex geometries
# keep = 0.05 means keep 5% of points (aggressive simplification)
# You can adjust this value: higher = less simplification (0.01 = 1%, 0.1 = 10%)
mv_simpl <- ms_simplify(pincode.map, keep = 0.0001, keep_shapes = TRUE)
ggplot(mv_simpl) + geom_sf()
